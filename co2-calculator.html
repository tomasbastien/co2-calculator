<html lang="en"> 
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
		<title>CO2 Calculator</title>
		<!-- LOCAL STYLESHEETS -->
		<link rel="stylesheet" href="css/assets/bootstrap/css/bootstrap.min.css" />
		<!-- <link rel="stylesheet" href="css/pow-fr.css" /> -->
		<link rel="stylesheet" href="css/custom.css" />
		<!-- EXTERNAL STYLESHEETS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
 		<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
 		<!-- EXTERNAL SCRIPTS -->
 		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
		<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
	</head>
	<body>
		<section class="position-relative py-4 py-xl-5"> 
			<div class="container position-relative">
				<div class="row d-flex justify-content-center">
					<div class="col-lg-8 col-xl-7 col-xxl-7">
						<div class="card mb-5">
							<div class="card-body p-sm-5">
								<h2 class="text-center mb-4">CO2 Calculator</h2>
								<div id="route-details">
									<div class="mb-3">
									<label for="cars">Choose a transportation:</label>
									  <select class="form-select" name="transportation" id="transportation" required onchange="show_options_settings(this)">
									  	<option value=""></option>
									  	<option value="Autobus">Autobus</option>
									    <option value="Bike">Bike</option>
									    <option value="City Bus">City Bus</option>
									    <option value="Car">Car</option>
									    <option value="Electric Car">Electric Car</option>
									    <option value="Plane">Plane</option>
									    <!-- <option value="SNCF">SNCF</option> -->
									    <option value="Regular train">Regular train</option>
									    <option value="High-speed train">High-speed train</option>
									    
									  </select>
									</div>
									<div class="mb-3" id="div-set-passengers-number"></div>
									<div class="mb-3" id="div-departure">
										<input id="departure" type="search" class="form-control empty" type="text" name="departure" placeholder="Departure" required />
									</div>
									<div class="mb-3" id="div-manage-step">
										<button id="div-invert-step" class="btn btn-primary" onclick="revert_geolocation_input_fields()"><i class="fa fa-exchange "> </i></button>
										<button id="div-add-step" class="btn btn-primary" style="display:none;" onclick="add_step()"><i class="fa fa-plus "></i></button>
										<button id="div-delete-step" style="display:none;" title="Remove step" class="btn btn-primary" onclick="delete_step()"><i class="fa fa-minus"></i></button>
									</div>
									<div class="mb-3" id="div-arrival">
										<input id="arrival" type="search" class="form-control empty" type="text" name="arrival" placeholder="Arrival" required/>
									</div>
								</div>
									<div class="mb-3" >
										<button class="btn btn-primary d-block w-100" onclick="calculate_co2_route()">Add this trip</button>
									</div>
									<div class="mb-3" >
										<button class="btn btn-secondary d-block w-100" onclick="clear_fields()">Clear</button>
									</div>
								<div id="loading" class="mb-3"></div>
								<div id="calculation-result" class="mb-3" style="display:none;"></div>
								<div id="map" class="mb-3" style="display:block; height: 300px;"></div>
								<div class="mb-3">
									<!-- Button trigger modal -->
									<button type="button" class="btn btn-light d-block w-100" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
									  How does this tool work ?
									</button>

									<!-- Modal -->
									<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
									  <div class="modal-dialog modal-lg">
									    <div class="modal-content">
									      <div class="modal-header">
									        <h5 class="modal-title" id="staticBackdropLabel">How does this tool work ?</h5>
									        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									      </div>
									      <div class="modal-body">
									        Based on provided geolocations, here's the operation mode to provide an <u>estimated</u> CO2e emission for the specified trip :
									        <ul class="">
									        	</br>
									        	<li>Each location string is sent to <strong>Nominatim Openstreetmap</strong> to query the OSM database for [lat,lon] GPS coordinates and stored in a list.</li>
									        	<ul>
									        		<li><em>This tool version takes the very first result of the query, so provided geolocation has to be the most accurate possible (using local state, city or country). It will be enhanced later to provide results list to the user.</em></li>
									        	</ul>
									        	</br>
									        	<li>This [lat,lon] GPS coordinates list is sent over a diffent routing API based on chosen transportation mode :
									        	</li>
									        	<ul>
									        	<li><strong>Openrouteservice directions API</strong> for any "road" mode
									        	, in order to plan a trip throught all these locations and obtain kilometers journey length and route as a GPS points array.</br><em>Openrouteservice directions API only supports transportation profiles driving-car and regular-bike, so public transportations may required to specify steps to match with the local public transportation plan. This could be also be a future enhancement.</em></li>
									        	<li><strong>A simple crowfly</strong> math calculation for plane and train, this needs to declare as many steps (railway station) as possible</li>
									        	<!-- <li><strong>SNCF journey API</strong> that will mix regular and high-speed train for the France area</li> -->
									        	</ul>
									        	</br>
									        	<li>Total kilometers is sent to <strong>Mon Impact Transport API</strong> (provided by ADEME, FR gov. ecologic transition agency), with chosen transportation mode. It returns kgco2e emissions, then divided by carpoolers if specified.</li>
									        	<ul>
									        		<li><em>Default passengers number is 1 for any other transportation than car an electric car, as estimation returned from ADEME for buses assumes an average transportation occupancy.</em></li>
									        	</ul>
									        	</br>
									        	<li>GPS points array is shown as a line over a <strong>LeafLet</strong> Map, centered to fit global itinerary within the tile. This is usefull to see if the tool actually match with expected or realized journey.</li>
									        </ul>
									        <div class="alert alert-dark" role="alert">
											  No data is stored on the server, all computation is done client-side by the  web-browser. All is HTML5/Javascript written and prettified with Bootstrap 5 CSS library.
											</div>
											All recensed bugs and futur features can be find on <a href="./changelog.html" class="link-dark">changelog page</a>.
									      </div>
									      <div class="modal-footer">
									        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
									      </div>
									    </div>
									  </div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<footer class="bg-light text-center text-lg-start">
		  <div class="container p-4">
		    <div class="row">
		      	<h5 class="text-uppercase">Data sources used</h5>
		      </br></br>
		      	<div class="col-lg-4 col-md-12 mb-4 mb-md-0">
			        <h6 class="text-uppercase">CO2e data provided by ADEME (FR gov. ecologic transition agency)</h6>
			        <p>
			          More details on <a  target="_blank"href="https://impactco2.fr/transport">https://impactco2.fr/transport</a>, documentation and API sources on <a  target="_blank"href="https://github.com/datagir/monimpacttransport">GitHub</a>.
			        </p>
			    </div>
			    <div class="col-lg-4 col-md-12 mb-4 mb-md-0">
			        <h6 class="text-uppercase">Route determined with OpenRouteService for road vehicules</h6>
			        <p>
			          More details on  <a target="_blank" href="https://openrouteservice.org/">https://openrouteservice.org/</a>, documentation and API sources on <a target="_blank" href="https://openrouteservice.org/dev/#/api-docs">dedicated web page</a>.
			        </p>
			        <h6 class="text-uppercase">Plane and simple train directions/distances determined with a straight crowfly</h6>
		    	</div>
		    	<div class="col-lg-4 col-md-12 mb-4 mb-md-0">
			        <h6 class="text-uppercase">GPS information retrieved from Openstreetmap via the Nominatim tool</h6>
			        <p>
			          More details on  <a target="_blank" href="https://nominatim.openstreetmap.org/">https://nominatim.openstreetmap.org/</a>, documentation and API sources on <a target="_blank" href="https://nominatim.org/release-docs/latest/api/Overview/">dedicated web page</a>.
			        </p>
		    	</div>
		    </div>
		  </div>

		  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
		    Â© 2023 - <a href="./changelog.html" class="link-dark">Changelog</a> - Version 2.0.0
		  </div>
		</footer>
	<!-- LOCAL SCRIPTS   -->
  <script src="js/utils.js"></script>
	</body>
</html>
